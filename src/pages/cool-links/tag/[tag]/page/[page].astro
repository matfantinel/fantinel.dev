---
import CoolLinksArchiveLayout from "@layouts/CoolLinksArchiveLayout.astro";
import { getAllTags, getPaginatedCoolLinks } from "@data/coolLinks";

export async function getStaticPaths() {
  const tags = await getAllTags();
  
  const paths = await Promise.all(
    tags.map(async (tag) => {
      const { totalPages } = await getPaginatedCoolLinks(1, tag.slug);
      return Array.from({ length: totalPages }).map((_, i) => ({
        params: { tag: tag.slug, page: String(i + 2) }, // start at page 2
      }));
    })
  );

  return paths.flat();
}

const { tag, page } = Astro.params;
const { links, currentPage, totalPages, totalLinks } = await getPaginatedCoolLinks(Number(page), tag);

const allTags = await getAllTags();
const currentTag = allTags.find((t) => t.slug === tag);
---

<CoolLinksArchiveLayout
  links={links}
  currentPage={currentPage}
  totalPages={totalPages}
  totalLinks={totalLinks}
  currentTag={currentTag}
  allTags={allTags}
/>
