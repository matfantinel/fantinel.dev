---
import BlogArchiveLayout from "@layouts/BlogArchiveLayout.astro";
import { getAllCategorySlugs, getPaginatedPosts } from "@data/blogPosts";

export async function getStaticPaths() {
  const categories = await getAllCategorySlugs();
  
  const paths = await Promise.all(
    categories.map(async (category) => {
      const { totalPages } = await getPaginatedPosts(1, category);
      return Array.from({ length: totalPages }).map((_, i) => ({
        params: { category, page: String(i + 2) }, // start at page 2
      }));
    })
  );

  return paths.flat();
}

const category = Astro.params.category;
const pageParam = Number(Astro.params.page);
const { posts, currentPage, totalPages } = await getPaginatedPosts(pageParam, category);
---

<BlogArchiveLayout
  posts={posts}
  currentPage={currentPage}
  totalPages={totalPages}
  category={category}
/>
