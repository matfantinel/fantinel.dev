---
import PostLayout from "@layouts/PostLayout.astro";
import { getCollection } from "astro:content";
import readingTime from 'reading-time/lib/reading-time';
import striptags from 'striptags';

export async function getStaticPaths () {
  const posts = await getCollection('blog');

  // Calculate reading time of each post
  posts.forEach(post => {
    if (post.body) {
      post.data.readingTime = readingTime(striptags(post.body)).text
    }

    // TODO: Author is gonna be a post type
    if (!post.data.author) {
      post.data.author = {
        name: "Matt Fantinel", 
        image: "https://www.gravatar.com/avatar/08fc2cb6e6efa9c31179805bc0e8d8bd?s=100"
      };
    }
  });

  return posts.map(post => ({
    params: {
      slug: post.data.slug
    },
    props: { post }
  }));
};

const { post } = Astro.props;
---

<PostLayout
  post={post}
/>